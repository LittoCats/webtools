/*******************************************************************************
 * @author      : 程巍巍 (littocats@gmail.com)
 * @created     : Wednesday Aug 10, 2022 20:49:40 CST
 *
 * @description : index
 *
 ******************************************************************************/
import { useState as useReactState, useCallback as useReactCallback, useRef as useReactRef, useMemo as useReactMemo, useContext as useReactContext, createContext as createReactContext, } from "react";
import update from "immutability-helper";
export function createContext(defaults) {
    return createReactContext([
        defaults,
        (spec) => {
            if (spec)
                console.warn(`Default context value can't be updated.`);
            return defaults;
        },
    ]);
}
export function useState(init) {
    const _ = useReactState(init);
    const s = _[0], u = _[1];
    const r = useReactRef(s);
    const d = useReactCallback((spec) => {
        if (spec) {
            const next = update(r.current, spec);
            if (r.current !== next)
                u((r.current = next));
        }
        return r.current;
    }, []);
    return useReactMemo(() => [s, d], [s, d]);
}
export function useContext(Context, k1, k2, k3, k4) {
    const _ = useReactContext(Context);
    const s = _[0], d = _[1];
    const state = useReactMemo(() => {
        const K = [k1, k2, k2, k4];
        let state = s;
        for (let i = 0; i < K.length;)
            state = state === null || state === void 0 ? void 0 : state[K[i++]];
        return state;
    }, [s, k1, k2, k3, k4]);
    const dispatch = useReactCallback((spec) => {
        const K = [k1, k2, k2, k4];
        if (spec)
            for (let i = 0; i < K.length;) {
                const origin = spec;
                spec = {};
                spec[K[i++]] = origin;
            }
        return d(spec);
    }, [d, k1, k2, k3, k4]);
    return useReactMemo(() => [state, dispatch], [state, dispatch]);
}
export const Immutable = {
    createContext,
    useState,
    useContext,
};
export default Immutable;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O2dGQU1nRjtBQUVoRixPQUFPLEVBQ0wsUUFBUSxJQUFJLGFBQWEsRUFDekIsV0FBVyxJQUFJLGdCQUFnQixFQUMvQixNQUFNLElBQUksV0FBVyxFQUNyQixPQUFPLElBQUksWUFBWSxFQUN2QixVQUFVLElBQUksZUFBZSxFQUM3QixhQUFhLElBQUksa0JBQWtCLEdBRXBDLE1BQU0sT0FBTyxDQUFDO0FBQ2YsT0FBTyxNQUFnQixNQUFNLHFCQUFxQixDQUFDO0FBRW5ELE1BQU0sVUFBVSxhQUFhLENBQUksUUFBVztJQUMxQyxPQUFPLGtCQUFrQixDQUFDO1FBQ3hCLFFBQVE7UUFDUixDQUFDLElBQWEsRUFBRSxFQUFFO1lBQ2hCLElBQUksSUFBSTtnQkFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLHlDQUF5QyxDQUFDLENBQUM7WUFDbEUsT0FBTyxRQUFRLENBQUM7UUFDbEIsQ0FBQztLQUNGLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxNQUFNLFVBQVUsUUFBUSxDQUFJLElBQW1CO0lBQzdDLE1BQU0sQ0FBQyxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQ1osQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNYLE1BQU0sQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6QixNQUFNLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDLElBQWEsRUFBRSxFQUFFO1FBQzNDLElBQUksSUFBSSxFQUFFO1lBQ1IsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDckMsSUFBSSxDQUFDLENBQUMsT0FBTyxLQUFLLElBQUk7Z0JBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQy9DO1FBQ0QsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDO0lBQ25CLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUVQLE9BQU8sWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQXlCRCxNQUFNLFVBQVUsVUFBVSxDQUN4QixPQUFZLEVBQ1osRUFBUSxFQUNSLEVBQVEsRUFDUixFQUFRLEVBQ1IsRUFBUTtJQUVSLE1BQU0sQ0FBQyxHQUFHLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNuQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQ1osQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNYLE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQyxHQUFHLEVBQUU7UUFDOUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzQixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU07WUFBSSxLQUFLLEdBQUcsS0FBSyxhQUFMLEtBQUssdUJBQUwsS0FBSyxDQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN4QixNQUFNLFFBQVEsR0FBRyxnQkFBZ0IsQ0FDL0IsQ0FBQyxJQUFTLEVBQUUsRUFBRTtRQUNaLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDM0IsSUFBSSxJQUFJO1lBQ04sS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEdBQUk7Z0JBQzlCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQztnQkFDcEIsSUFBSSxHQUFHLEVBQUUsQ0FBQztnQkFDVixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7YUFDdkI7UUFDSCxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqQixDQUFDLEVBQ0QsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQ3BCLENBQUM7SUFFRixPQUFPLFlBQVksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBQ2xFLENBQUM7QUFDRCxNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUc7SUFDdkIsYUFBYTtJQUNiLFFBQVE7SUFDUixVQUFVO0NBQ1gsQ0FBQztBQUVGLGVBQWUsU0FBUyxDQUFDIn0=